print ("Calculate valued gcor matrix")

cal.val.hamming<-function(x){
#x is a list of graph's adjacent matrix
#create empty distance matrix
n<-length(x)
m<-matrix(numeric(0),n,n)

for(i in 1:n){
	print(i)
for(j in i:n){
	m1<-x[[i]]
	m2<-x[[j]]
	#flatten the matrix
	m1<-as.vector(m1)
	m2<-as.vector(m2)
	#pearson correlation
	correlation<-cor(m1,m2)
	m[i,j]<-m[j,i]<-correlation
} 
}#i loop  	
return(m)
}#end cal.val.hamming


create.adjacent.matrix<-function(g){
vertices<-g$v
n<-length(vertices)
m<-matrix(numeric(0),n,n)

for(i in 1:n){
for(j in i:n){
	v1<-vertices[[i]]
	v2<-vertices[[j]]
	eid<-get.edgeIDs(g,v1$vertex.names,v2$vertex.names)
	if(length(eid)==0){value<-0}
	else
	{value<-g$mel[[eid]]$atl$weight}
	m[i,j]<-m[j,i]<-value
}
}

return(m)
}#create.adjacent.matrix




adjacent.matrix_db<-lapply(graph_db,create.adjacent.matrix)
valued.gcor.matrix<-cal.val.hamming(adjacent.matrix_db)
valued.gcor.matrix<-1-abs(valued.gcor.matrix)
valued.gcor.matrix[is.na(valued.gcor.matrix)]=1#if it is a correlation distance matrix, setting all NaNs to 1
valued.gcor.agn<-agnes(valued.gcor.matrix,method="ward")



